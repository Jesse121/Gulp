define("index",["cookie","rsa","user","common","component","validate","lazyload"],function(require,exports,module){function autoLoginCountDown(e){var i=e;0!=i?(i--,setTimeout(function(){autoLoginCountDown(i)},1e3)):$(".home_logined").is(":hidden")&&("/user/showRegister"==$(window.parent.document).find("iframe").attr("src")||"/user/showLogin"==$(window.parent.document).find("iframe").attr("src")||$("#login-form input").eq(0).is(":focus")||$("#login-form input").eq(1).is(":focus")||user.showLoginPanel(),autoLoginCountDown(5))}function beginLoad(){var e=$(window).scrollTop(),i=$(window).height(),n=$(document).height(),o=n-e-i;if(scrollLock||n==i)return!1;o<200&&(scrollLock=!0,loadIndexPage(++page))}function loadIndexPage(page){$.ajax({url:"/indexV3/getRoomInfo",data:{page:page},type:"post",dataType:"json",beforeSend:function(){$(".index_load_hint").show()},success:function(e){scrollLock=!1,0==e.errno?updateNew(e.data):100==e.errno&&($(".index_load_hint").hide(),$(".click_load_more p").text("已加载所有数据").parent(".click_load_more").off(),$(window).off("scroll"))},complete:function(data){var responseText=eval("("+data.responseText+")");0==responseText.errno&&$(".index_load_hint").hide()},error:function(e){scrollLock=!1,$(".index_load_hint").text("数据加载出错"+e).show()}})}function update(e){for(var i=e.rooms,n=(e.online_num,""),o=0;o<i.length;o++){var a=i[o],r="",s='<span class="viewer" >'+a.onlineNum+"</span>";1==a.isPlaying&&(r='<i class="on">直播</i>',s='<span class="viewer" >'+a.onlineNum+"</span>"),n+='<dl class="room-item" rid="'+a.rid+'">                <dt class="new">'+r+'<img src="http://static.guojiang.tv/pc/img/common/lazyload.jpg?v=0513" data-original = "'+a.headPic+'" class="lazy" width="210" >                    <noscript><img src="'+a.logo+'" width="210" ></noscript>                    <a class="top_mask" target="_blank" href="/'+a.mid+'">                        <div class="list_hover_mask"></div>                        <div class="start"></div>                    </a>                    <div class="mask_num">'+s+'<span class="like" rid="'+a.rid+'">'+a.fansNum+'</span>                        <span class="list_mask"></span>                    </div>                </dt>                <dd>                    <a class="bigTitle room-link" target="_blank" href="/'+a.mid+'">                        <span class="list_nickname">'+a.nickname+' </span>                        <span class="fr level_icon m_level_icon_'+a.moderatorLevel+' "></span>                    </a>                    <p class="desc" title="'+a.announcement+'">'+a.announcement+"</p>                </dd>              </dl>            "}$(".index_recommend").append(n),$("img.lazy").show().lazyload()}function updateNew(e){for(var i=e.rooms,n=(e.online_num,""),o=0,a=i.length;o<a;o++){var r=i[o],s="",t=parseInt(6*Math.random());1==r.isPlaying&&(s='<span class="online-num"><i></i>'+r.onlineNum+"</span>"),n+='<dl class="room-item" rid="'+r.rid+'">                              <dt style="background:'+colors[t]+'">                                  <a target="_blank" href="/'+r.mid+'">'+s+'<img data-original = "'+r.headPic+'" src=""  class="lazy" alt="">                                    <div class="start">                                      <i></i>                                    </div>                                  </a>                              </dt>                              <dd>                                <div class="m-pic" style="background:'+colors[t]+'">                                    <img class="lazy" data-original = "'+r.headPic+'" src="" alt="">                                </div>                                <div class="m-desc">                                  <h3 class="nickname">'+r.nickname+"</h3>                                  <p>"+r.announcement+"</p>                                </div>                              </dd>                            </dl>"}$(".room-box").append(n),$("img.lazy").show().lazyload()}function doSlide(e){if(!sliding){var i=$("#sliderPanel li:eq("+e+")");if(i.hasClass("on"))return!1;var n=$("#sliderPanel li.on");n.removeClass("on"),i.addClass("on"),$("#sliderItem .sliderItem:eq("+n.index()+")").fadeOut(200,function(){$("#sliderItem .sliderItem:eq("+e+")").fadeIn(200)}),e<visible_start?(marginLeft+=95*(visible_start-e),visible_end=(visible_start=e)+2):e>visible_end&&(marginLeft+=95*(visible_end-e),visible_start=e-2,visible_end=e),sliding=!1}}var user=require("user"),common=require("common"),index=require("index");$(window).width()<1280&&($(".footer.wrap").css("width","1000px"),$(".ie7 .side_tool, .ie8 .side_tool").css({"margin-right":"0px",right:"10px"}));var rsa=new(require("rsa").RSA);autoLoginCountDown(5),require("component")($),$(".topLogin input[name=username]").gjPlaceHolder({fontSize:"13px",placeHolderColor:"rgba(255,255,255,0.6)",top:3,left:36,inputTextColor:"#fff",content:"用户名/手机号/邮箱",relParent:$(".topLogin .input_wrap.first")}),$(".topLogin input[name=password]").gjPlaceHolder({fontSize:"13px",placeHolderColor:"rgba(255,255,255,0.6)",top:3,left:36,inputTextColor:"#fff",content:"密码",relParent:$(".topLogin .input_wrap").eq(1)});var forget_hover_flag;$(".forget_password_icon").hover(function(){$(".forget_password_link").show(),forget_hover_flag=0},function(){setTimeout(function(){$(".forget_password_link").mouseover(function(){forget_hover_flag=1}),0==forget_hover_flag?$(".forget_password_link").hide():$(".forget_password_link").mouseout(function(){$(this).hide()})},500)});var isLogining=!1;$("#login-form").validate({errorClass:"login_error_hint",rules:{username:"required",password:"required"},messages:{username:"用户名不能为空",password:"密码不能为空"},showErrors:function(){},submitHandler:function(){if(!isLogining){common.buttonTextLoading(this.submitButton,"登录中"),isLogining=!0;var e=this;common.getPublicKey(function(i){var n=i.key,o=i.session_id;rsa.setPublicKey(n);var a={username:$("#login-form input[name=username]").val(),password:rsa.encrypt($("#login-form input[name=password]").val()),remember:$("#autoLogin")[0].checked};$.ajax({url:"/user/login/session_id/"+o,type:"post",data:a,dataType:"json",success:function(i){if(common.stopButtonTextLoading(e.submitButton,"登录"),isLogining=!1,0==i.errno)setTimeout(function(){top.location.reload()},300);else if(400==i.errno)for(var n in i.data){layer.alert(i.data[n]);break}else 404==i.errno?user.showBindPanel():$(".login_error_hint").show().text(i.msg)}})})}}}),$(".center_btn_wrap,.user_info_wrap").mouseover(function(){$(".home_avatar_wrap").hide().siblings(".user_info_wrap").show()}).mouseout(function(){$(".home_avatar_wrap").show().siblings(".user_info_wrap").hide()}),$(".index_register").click(user.showRegisterPanel),$(".center_btn_wrap").hover(function(){$(".edit_nickname").hide()}),$(".edit_nickname_btn").click(function(){$(".edit_nickname").is(":hidden")?$(".edit_nickname").show():$(".edit_nickname").hide()}),$("#doEditNickname").click(function(){var e=$.trim($("#newNickname").val());e?$.ajax({url:"/user/updateUserInfo/scene/nickname",type:"post",dataType:"json",data:{nickname:e},success:function(e){e.errno?layer.alert(e.msg):(layer.msg("昵称更新成功",{icon:1}),setTimeout(function(){location.reload()},3e3))}}):layer.alert("昵称不能为空")}),$("#cancelEditNickname").click(function(){$(".edit_nickname").hide()}),$(".sideBox").each(function(){var e=$(this),i=e.find(".side_title ul li");i.on("click",function(){var n=$(this),o=n.data("type");e.find(".side_rank").hide(),"day"==o&&e.find(".last_day").show(),"week"==o&&e.find(".week").show(),"month"==o&&e.find(".month").show(),"all"==o&&e.find(".all").show(),i.removeClass("active"),n.addClass("active")})}),function(){for(var e=$(".slide_img_contain .room-item dt img"),i=0;i<5;i++)e.eq(i).addClass("lazy")}(),$(".sidebar-room").hover(function(){$(this).addClass("on")},function(){$(this).removeClass("on")}),$("img.lazy").show().lazyload({effect:"fadeIn"}),$("img.lazy_container").show().lazyload({effect:"fadeIn",event:"sporty"}),$(".slide_img_wrap .next_img_btn ").on("click",function(){$("img.lazy_container").trigger("sporty")}),$(".slide_img_wrap").exchangeImg({visibleNum:4,singleDomWidth:300,slideDomNum:4});var page=1;scrollLock=!1,$(".click_load_more").on("click",function(){beginLoad()}),$(window).on("scroll",function(){beginLoad()});var colors=["#c3b19d","#a3a7b9","#8fb3bf","#bdaba9","#b7adad","#dbbfb3"],visible_start=0,visible_end=2,sliding=!1,marginLeft=0;curr_index=0,function(){var e=$(".sliderSmall li"),i=(e.eq(0).width()+24)*e.length;e.length>1&&$(".sliderSmall ul").width(i).show()}(),exports.slide=function(){var e=$("#sliderItem .sliderItem").length;$("#sliderPanel li").click(function(){curr_index=$(this).index(),doSlide($(this).index())}),setInterval(function(){++curr_index>=e&&(curr_index=0),doSlide(curr_index)},1e4),$(".sliderRight").click(function(){curr_index+1==e&&(curr_index=-1),doSlide(++curr_index)}),$(".sliderLeft").click(function(){0==curr_index&&(curr_index=e),doSlide(--curr_index)})}});